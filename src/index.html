<!DOCTYPE html>
<html lang="en">
<head>
    <title>three.js webgl - GLTFloader</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
 

    <link type="text/css" rel="stylesheet" href="main.css">
</head>

<body>

<script type="importmap">
    {
        "imports": {
            "three": "../build/three.module.js",
            "three/addons/": "./jsm/"
        }
    }
</script>
<script src=""></script>

<script type="module">
    import * as THREE from 'three';
    import { OrbitControls } from '../loader/OrbitControls.js';
    import { GLTFLoader } from '../loader/GLTFLoader.js';
    import { RGBELoader } from '../loader/RGBELoader.js';
    import { gsap } from 'https://cdn.skypack.dev/gsap@3';

    let camera, scene, renderer, controls, model, targetObject,targetObject1,targetObject4;
    let wallpapers = ['./texture/bedsheet1.jpg', './texture/bedsheet2.jpeg', './texture/bedsheet3.jpg', './texture/bedsheet4.jpg', './texture/bedsheet5.jpg'];
    let currentWallpaperIndex = 0;
    let bed = ['./texture/wallpaper1.jpeg', './texture/wallpaper2.jpeg', './texture/wallpaper3.jpeg', './texture/wallpaper4.jpeg', './texture/wallpaper5.jpeg'];
    let currentbedIndex = 2;
    init();

    function init() {
        const container = document.createElement('div');
        document.body.appendChild(container);

        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);

        camera.position.set(0, 0.5, -1.4);

        scene = new THREE.Scene();

        const loader = new GLTFLoader().setPath('model/');
        loader.load('Bed Room.glb', async function(gltf) {
            model = gltf.scene;

            // Load the default exture
            const defaultTexture = new THREE.TextureLoader().load(wallpapers[currentWallpaperIndex]);
            const bedTexture = new THREE.TextureLoader().load(bed[currentbedIndex]);

            // Create material with default texture
            const defaultMaterial = new THREE.MeshBasicMaterial({ map: defaultTexture });
            const bedMaterial = new THREE.MeshBasicMaterial({ map: bedTexture });

            // Traverse through the model to find walls and assign default material
            model.traverse(function(child) {
                if (child instanceof THREE.Mesh && child.name.includes('Bedrest_Bed_sheet_0')) {
                    child.material = defaultMaterial;
                }
            });
            model.traverse(function(child) {
                if (child instanceof THREE.Mesh && child.name.includes('Wall_Similer_main_0')) {
                    child.material = bedMaterial;
                }
            });

            await renderer.compileAsync(model, camera, scene);
            scene.add(model);
            console.log(model,'model name');
            render();
        });
   
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.toneMappingExposure = 1;
        container.appendChild(renderer.domElement);

           // Create a sphere for the background
    var sphereGeometry = new THREE.SphereGeometry(500, 60, 40);
    var sphereMaterial = new THREE.MeshBasicMaterial({
        side: THREE.BackSide // Make it visible from the inside
    });
    var backgroundSphere = new THREE.Mesh(sphereGeometry, sphereMaterial);
    scene.add(backgroundSphere);

    // Array to hold the paths of HDR images
    var hdriImages = ['./texture/cobblestone_street_night_2k.hdr', './texture/symmetrical_garden_02_2k.hdr'];
    var currentHDRIIndex = 0; // Index of the currently displayed HDR image

    // Click handler function
    function toggleBackground() {
    currentHDRIIndex = (currentHDRIIndex + 1) % hdriImages.length; // Cycle through the images
    var newHDRI = hdriImages[currentHDRIIndex];
    new RGBELoader()
        .setDataType(THREE.FloatType) // Change the data type
        .load(newHDRI, function (texture) {
            backgroundSphere.material.map = texture; // Change the texture
            backgroundSphere.material.needsUpdate = true; // Update the material
        });
}


 // Add event listener to the button
 var toggleBackgroundBtn = document.getElementById('toggleBackgroundBtn');
    toggleBackgroundBtn.addEventListener('click', toggleBackground);


        // Add OrbitControls for mouse control
        controls = new OrbitControls(camera, renderer.domElement);
      
        const geometry = new THREE.CircleGeometry(0.1, 32);
        const material = new THREE.MeshBasicMaterial({ color: 0xffffff , side : THREE.DoubleSide });
        const circle = new THREE.Mesh(geometry, material);
        circle.position.set(0.2, 0.4, 0);
        circle.scale.set(0.5,0.5,0.5);
        scene.add(circle);

        const geometry3 = new THREE.CircleGeometry(0.1, 32);
        const material3 = new THREE.MeshBasicMaterial({ color: 0xffffff , side : THREE.DoubleSide });
        const circle3 = new THREE.Mesh(geometry, material);
        circle3.position.set(-0.7, 0.4, 0.4);
        circle3.scale.set(0.5,0.5,0.5);
        scene.add(circle3);

        const geometry5 = new THREE.CircleGeometry(0.1, 32);
        const material5 = new THREE.MeshBasicMaterial({ color: 0xffffff , side : THREE.DoubleSide });
        const circle5 = new THREE.Mesh(geometry5, material5);
        circle5.position.set(0, 0.3, 0.8);
        circle5.scale.set(0.5,0.5,0.5);
        scene.add(circle5);

        const geometry1 = new THREE.BoxGeometry();
        const material1 = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
        targetObject = new THREE.Mesh(geometry1, material1);
        targetObject.scale.set(0.1,0.1,0.1);
        targetObject.position.set(0.5,0.8,0);
       
        scene.add(targetObject);
        targetObject.visible = false;

        const geometry2 = new THREE.BoxGeometry();
        const material2 = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
        targetObject1 = new THREE.Mesh(geometry2, material2);
        targetObject1.scale.set(0.1,0.1,0.1);
        targetObject1.position.set(-0.3,0.8,0.3);
       
        scene.add(targetObject1);
        targetObject1.visible = false;

        const geometry4 = new THREE.BoxGeometry();
        const material4 = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
        targetObject4 = new THREE.Mesh(geometry4, material4);
        targetObject4.scale.set(0.1,0.1,0.1);
        targetObject4.position.set(0,0.2,1);
       
        scene.add(targetObject4);
        targetObject4.visible = false;

        // Add click event listener to the renderer's DOM element
        renderer.domElement.addEventListener('click', onClick);

        function onClick(event) {
            const mouse = new THREE.Vector2();
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = - (event.clientY / window.innerHeight) * 2 + 1;

            const raycaster = new THREE.Raycaster();
            raycaster.setFromCamera(mouse, camera);

            const intersects = raycaster.intersectObject(circle);
            const intersects3 = raycaster.intersectObject(circle3);
            const intersects4 = raycaster.intersectObject(circle5);

            if (intersects.length > 0) {
                // Circle clicked
                circle.visible = false;
                
                // alert('Circle clicked!');
                const targetPosition = targetObject.position.clone();
                const newPosition = targetPosition.clone().add(new THREE.Vector3(-1, 0, 0.1)); 
                gsap.to(camera.position, { x: newPosition.x, y: newPosition.y, z: newPosition.z, duration: 3 });
            }
            if (intersects3.length > 0) {
                // Circle clicked
                circle3.visible = false;
                const targetPosition1 = targetObject1.position.clone();
                const newPosition1 = targetPosition1.clone().add(new THREE.Vector3(0.9, -0.4, 0.1)); 
                gsap.to(camera.position, { x: newPosition1.x, y: newPosition1.y, z: newPosition1.z, duration: 3 });
                circle.visible = true;
                // alert('Circle clicked!');
           
            }

            if (intersects4.length > 0) {
                // Circle clicked
                circle5.visible = false;
                const targetPosition4 = targetObject4.position.clone();
                const newPosition4 = targetPosition4.clone().add(new THREE.Vector3(0, 0.4, -0.1)); 
                gsap.to(camera.position, { x: newPosition4.x, y: newPosition4.y, z: newPosition4.z, duration: 3 });
                circle.visible = true;
                circle3.visible = true;
                // alert('Circle clicked!');
           
            }
        }

        window.addEventListener('resize', onWindowResize);
        // document.getElementById('zoomButton').addEventListener('click', zoomToTarget);
        for (let i = 0; i < wallpapers.length; i++) {
            document.getElementById(`changeWallpaperButton${i}`).addEventListener('click', () => changeWallpaper(i));
        }

        for (let i = 0; i < bed.length; i++) {
            document.getElementById(`changebedButton${i}`).addEventListener('click', () => changebed(i));
        }
    }

    // function zoomToTarget() {
      
    //     const targetPosition4 = targetObject4.position.clone();
    //             const newPosition4 = targetPosition4.clone().add(new THREE.Vector3(0, 0.4, -0.1)); 
    //             gsap.to(camera.position, { x: newPosition4.x, y: newPosition4.y, z: newPosition4.z, duration: 3 });
    // }

    function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
        render();
    }

    function changeWallpaper(index) {
        currentWallpaperIndex = index;
        const newTextureLoader = new THREE.TextureLoader();
        newTextureLoader.load(wallpapers[currentWallpaperIndex], function(newTexture) {
            scene.traverse(function(child) {
                if (child instanceof THREE.Mesh && child.name.includes('Bedrest_Bed_sheet_0')) {
                    child.material.map = newTexture;
                    child.material.needsUpdate = true; // Update material
                }
            });
            render();
        });
    }

    function changebed(index) {
        currentbedIndex = index;
        const newTextureLoader1 = new THREE.TextureLoader();
        newTextureLoader1.load(bed[currentbedIndex], function(newTexture1) {
            scene.traverse(function(child) {
                if (child instanceof THREE.Mesh && child.name.includes('Wall_Similer_main_0')) {
                    child.material.map = newTexture1;
                    child.material.needsUpdate = true; // Update material
                }
            });
            render();
        });
    }

    function render() {
        
        requestAnimationFrame(render);
        controls.update();
        renderer.render(scene, camera);
    }

</script>

<div class="sidebar" id="sidebar">
    <!-- <button id="changeWallpaperButton0"><img src="wallpaper1.jpg"></button>
    <button id="changeWallpaperButton1"><img src="wallpaper2.jpg"></button>
    <button id="changeWallpaperButton2"><img src="wallpaper3.jpg"></button>
    <button id="changeWallpaperButton3"><img src="wallpaper4.jpg"></button>
    <button id="changeWallpaperButton4"><img src="wallpaper5.jpg"></button> -->
    <!-- <button id="zoomButton">Camera Animation</button> -->
<button id="changeWallpaperButton">Show Texture</button>
<button id="changebedButton">Show wall Texture</button>

<button id="toggleBackgroundBtn">Toggle Background</button>
    <div class="container hidden">
        <div class="top-images">
            <button id="changeWallpaperButton0"><img src="./texture/bedsheet1.jpg"></button>
            <button id="changeWallpaperButton1"><img src="./texture/bedsheet2.jpeg"></button>
            <button id="changeWallpaperButton2"><img src="./texture/bedsheet3.jpg"></button>
        </div>
        <div class="bottom-images">
            <button id="changeWallpaperButton3"><img src="./texture/bedsheet4.jpg"></button>
            <button id="changeWallpaperButton4"><img src="./texture/bedsheet5.jpg"></button>
        </div>
    </div>

    <div class="container1 hidden1">
        <div class="top-images1">
            <button id="changebedButton0"><img src="./texture/wallpaper1.jpeg"></button>
            <button id="changebedButton1"><img src="./texture/wallpaper2.jpeg"></button>
            <button id="changebedButton2"><img src="./texture/wallpaper3.jpeg"></button>
        </div>
        <div class="bottom-images1">
            <button id="changebedButton3"><img src="./texture/wallpaper4.jpeg"></button>
            <button id="changebedButton4"><img src="./texture/wallpaper5.jpeg"></button>
        </div>
    </div>
    <span class="close-icon" onclick="toggleSidebar()"><img src="./icon/close.png"  ></span>
</div>

<div class="footer">
    <div class="icon" onclick="toggleSidebar()"><img src="./icon/change.jpeg" ></div>
    <div class="icon" onclick="toggleSidebar()"><img src="./icon/change.jpeg" ></div>
    <div class="icon" onclick="toggleSidebar()"><img src="./icon/change.jpeg" ></div>
    <div class="icon" onclick="toggleSidebar()"><img src="./icon/change.jpeg" ></div>
</div>

<script>
    function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        if (sidebar.style.left === '0px') {
            sidebar.style.left = '-200px'; // hide sidebar
            var container = document.querySelector(".container");
    container.classList.toggle("hidden");
    var container = document.querySelector(".container1");
    container.classList.toggle("hidden1");
        } else {
            sidebar.style.left = '0px'; // show sidebar
            
        }
    }
</script>
<script>
    document.getElementById("changeWallpaperButton").addEventListener("click", function() {
    var container = document.querySelector(".container");
    container.classList.toggle("hidden");
    
});

document.getElementById("changebedButton").addEventListener("click", function() {
    var container = document.querySelector(".container1");
    container.classList.toggle("hidden1");
});

</script>
</body>
</html>
